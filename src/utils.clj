(ns utils
  (:require [clojure.string :only (trim upper-case replace blank?) :as st]))

(def prf)
(def CLM "CLM")
(def TXT "TXT")
(def ORD "ORD")
(def DIV "DIV")
(def HDN "HDN")
(def RT "RT")
(def GRP "GRP")
(def MTA "MTA")
(def EXC "EXC")
(def group-fun (list "AVG" "COUNT" "DISTINCT" "MAX" "MIN" "SUM"))

(def db-grph-keys [:fkcolumn_name :pktable_name :fktable_name])
(def ams-graph '([:AMS_LEVEL_GRADE_MAP :AMS_PGM_METADATA_FIELD_VALUE "LEVEL_REF_ID"] [:AMS_ADP_METADATA_FV :AMS_PGM_METADATA_FIELD_VALUE "PGM_MDV_REF_ID"] [:AMS_WF_ACTIVITY :AMS_WF_PROCESS_DEF "PROCESS_DEF_REFID"] [:AMS_USER :AMS_ADDRESS "USER_ADDRESS_ID"] [:AMS_ART_ASSET_FILE :AMS_ART_ASSET "ART_ASSET_REFID"] [:AMS_STIMULUS_ALIGN_SCHEME :AMS_ASSET_DEV_PLAN "ADP_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ASSET_DEV_PLAN "ADP_REF_ID"] [:AMS_ASSET_ORDER :AMS_ASSET_DEV_PLAN "ADP_REF_ID"] [:AMS_ASSET_DEV_PLAN :AMS_ASSET_DEV_PLAN "PARENT_REF_ID"] [:AMS_ADP_METADATA_FV :AMS_ASSET_DEV_PLAN "ADP_REF_ID"] [:AMS_ASSET_ORDER_ALIGN :AMS_ORDER_DETAIL "ORDER_DETAIL_REFID"] [:AMS_SEQ_REPORT :AMS_SEQUENCE "SEQUENCE_ID"] [:AMS_SEQUENCE_ELEMENT :AMS_SEQUENCE "SEQUENCE_ID"] [:AMS_SEQUENCE_ATTRIBUTE :AMS_SEQUENCE "SEQUENCE_ID"] [:AMS_WF_STATE :AMS_METADATA_VALUE "REJECT_REASON"] [:AMS_USER :AMS_METADATA_VALUE "DEPARTMENT"] [:AMS_PGM_METADATA_FIELD_VALUE :AMS_METADATA_VALUE "METADATA_VALUE_ID"] [:AMS_OTHER_ASSET_FV :AMS_METADATA_VALUE "MDV_REFID"] [:AMS_ORDER_METADATA_FV :AMS_METADATA_VALUE "METADATA_VALUE_REFID"] [:AMS_LEVEL_GRADE_MAP :AMS_METADATA_VALUE "GRADE_REF_ID"] [:AMS_ADP_METADATA_FV :AMS_METADATA_VALUE "METADATA_VALUE_REF_ID"] [:AMS_TEI_EXTENSION :AMS_ASSESSMENT_ITEM "ITEM_REF_ID"] [:AMS_ITEM_TOOLS :AMS_ASSESSMENT_ITEM "ITEM_REF_ID"] [:AMS_ITEM_STANDARD_ALIGNMENT :AMS_ASSESSMENT_ITEM "ITEM_REF_ID"] [:AMS_HOTSPOT_EXTENSION :AMS_ASSESSMENT_ITEM "ITEM_REF_ID"] [:AMS_CONTENT_PART :AMS_ASSESSMENT_ITEM "ITEM_REF_ID"] [:AMS_STANDARD :AMS_STANDARD_SET "STANDARD_SET_REFID"] [:AMS_PGM_STANDARD_ALIGNMENT :AMS_STANDARD_SET "STANDARD_SET_REFID"] [:AMS_HOTSPOT_CHOICE :AMS_TYPE_QUANTITY "TYPE_QUANTITY_REF_ID"] [:AMS_WF_STATE_SMY :AMS_ASSET "ASSET_ID"] [:AMS_WF_STATE :AMS_ASSET "ASSET_ID"] [:AMS_TEST_FORM :AMS_ASSET "ASSET_ID"] [:AMS_TEST :AMS_ASSET "ASSET_ID"] [:AMS_TEI_EXTENSION :AMS_ASSET "FOREGRND_ART_ASSET_ID"] [:AMS_TEI_EXTENSION :AMS_ASSET "BACKGRND_ART_ASSET_ID"] [:AMS_TEI_EXTENSION :AMS_ASSET "TEI_ART_ASSET_ID"] [:AMS_TEI_EXTENSION :AMS_ASSET "HS_ICON_ART_ASSET_ID"] [:AMS_STIMULUS :AMS_ASSET "ASSET_ID"] [:AMS_SEQUENCE_ELEMENT :AMS_ASSET "ASSET_ID"] [:AMS_PUBCONFIG_ASSET :AMS_ASSET "ASSET_ID"] [:AMS_PGM_ASSET_ALIGNMENT :AMS_ASSET "ASSET_ID"] [:AMS_OTHER_ASSET :AMS_ASSET "ASSET_ID"] [:AMS_HOTSPOT_EXTENSION :AMS_ASSET "BACKGRND_ART_ASSET_ID"] [:AMS_HOTSPOT_EXTENSION :AMS_ASSET "HS_ICON_ART_ASSET_ID"] [:AMS_HOTSPOT_CHOICE :AMS_ASSET "ART_ASSET_ID"] [:AMS_HOTSPOT_CHOICE :AMS_ASSET "ALT_ART_ASSET_ID"] [:AMS_ASSET_ORDER_ALIGN :AMS_ASSET "ASSET_ID"] [:AMS_ASSET_ORDER :AMS_ASSET "PARENT_ASSET_ID"] [:AMS_ASSET_FILE :AMS_ASSET "ASSET_ID"] [:AMS_ASSET_ASSOCIATION :AMS_ASSET "ASSET_ID_1"] [:AMS_ASSET_ASSOCIATION :AMS_ASSET "ASSET_ID_2"] [:AMS_ASSESSMENT_ITEM :AMS_ASSET "ASSET_ID"] [:AMS_ART_ASSET :AMS_ASSET "ASSET_ID"] [:AMS_TYPE_QUANTITY :AMS_HOTSPOT_EXTENSION "HS_EXT_REF_ID"] [:AMS_HOTSPOT_CHOICE :AMS_HOTSPOT_EXTENSION "HS_EXT_REF_ID"] [:AMS_SEQUENCE_ELEMENT :AMS_SEQUENCE_ELEMENT "PARENT_SEQUENCE_ELEMENT_ID"] [:AMS_STIMULUS_ALIGN_SCHEME :AMS_ADP_METADATA_FV "PASSAGE_TYPE_REF_ID"] [:AMS_STIMULUS_ALIGN_SCHEME :AMS_ADP_METADATA_FV "STIMULUS_SRC_REF_ID"] [:AMS_ORDER_METADATA_FV :AMS_ADP_METADATA_FV "ADP_METADATA_REFID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "ASSET_TYPE_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "COGNITIVE_LEVEL_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "DIFFICULTY_LEVEL_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "KNOWLEDGE_LEVEL_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "PERFORMANCE_LEVEL_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_ADP_METADATA_FV "ASSET_SUBTYPE_REF_ID"] [:AMS_PROGRAM :AMS_ACCOUNT "ACCOUNT_ID"] [:AMS_STANDARD :AMS_STANDARD "PARENT_REFID"] [:AMS_ITEM_STANDARD_ALIGNMENT :AMS_STANDARD "STANDARD_REF_ID"] [:AMS_ITEM_STANDARD_ALIGNMENT :AMS_STANDARD "ROOT_STANDARD_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_STANDARD "STANDARD_REFID"] [:AMS_ORDER_DETAIL :AMS_ITEM_ALIGN_SCHEME "ITEM_ALIGN_SCHEME_REFID"] [:AMS_USER_ROLE_PERMISSION :AMS_USER_ROLE "USER_ROLE_ID"] [:AMS_USER_ROLE_GROUP :AMS_USER_ROLE "MEMBER_OF_ROLE"] [:AMS_USER_ROLE_GROUP :AMS_USER_ROLE "ROLE_REFERENCE_ID"] [:AMS_USER_ACCOUNT_ROLE :AMS_USER_ROLE "MEMBER_OF_ROLE"] [:AMS_AUTH_GRANT :AMS_USER_ROLE "USER_ROLE_ID"] [:AMS_STIMULUS_READABILITY_ALIGN :AMS_STIMULUS "STIMULUS_REF_ID"] [:AMS_CONTENT_PART :AMS_STIMULUS "STIMULUS_REF_ID"] [:AMS_ASSET_CONTENT :AMS_CONTENT_PART "CONTENT_PART_REF_ID"] [:AMS_STIMULUS :AMS_ADP_DEV_YEAR "DEV_YEAR_CODE"] [:AMS_ASSET_DEV_PLAN :AMS_ADP_DEV_YEAR "DEV_YEAR_CODE"] [:AMS_ASSESSMENT_ITEM :AMS_ADP_DEV_YEAR "DEV_YEAR_CODE"] [:AMS_WF_ACTIVITY :AMS_WF_ACTIVITY_DEF "ACTIVITY_DEF_REFID"] [:AMS_STIMULUS_SPECIFICATION :AMS_PROGRAM "PROGRAM_REFERENCE_ID"] [:AMS_SEQUENCE :AMS_PROGRAM "PROGRAM_ID"] [:AMS_REPORTING_CATEGORY :AMS_PROGRAM "PROGRAM_REF_ID"] [:AMS_PROGRAM :AMS_PROGRAM "PARENT_ID"] [:AMS_PGM_STANDARD_ALIGNMENT :AMS_PROGRAM "PROGRAM_ID"] [:AMS_PGM_RATIONALE_SET :AMS_PROGRAM "PROGRAM_REF_ID"] [:AMS_PGM_METADATA_FIELD :AMS_PROGRAM "PROGRAM_ID"] [:AMS_PGM_ASSET_ALIGNMENT :AMS_PROGRAM "PROGRAM_REF_ID"] [:AMS_METADATA_VALUE :AMS_PROGRAM "PROGRAM_REFID"] [:AMS_COPYRIGHT :AMS_PROGRAM "PROGRAM_REFERENCE_ID"] [:AMS_AUTH_GRANT :AMS_PROGRAM "PROGRAM_ID"] [:AMS_ASSET_PAY_RATE :AMS_PROGRAM "PROGRAM_REF_ID"] [:AMS_ASSET_ORDER :AMS_PROGRAM "PROGRAM_REF_ID"] [:AMS_ASSET_DEV_PLAN :AMS_PROGRAM "PROGRAM_ID"] [:AMS_ORDER_DETAIL :AMS_STIMULUS_ALIGN_SCHEME "STIMULUS_ALIGN_REFID"] [:AMS_PGM_METADATA_FIELD_VALUE :AMS_PGM_METADATA_FIELD "PROGRAM_METADATA_FIELD_ID"] [:AMS_WF_STATE :AMS_ASSET_STATUS_VALUE "STATUS_1"] [:AMS_WF_STATE :AMS_ASSET_STATUS_VALUE "STATUS_2"] [:AMS_ASSET_STATUS_VALUE :AMS_ASSET_STATUS_VALUE "PARENT"] [:AMS_ASSET :AMS_ASSET_STATUS_VALUE "STATUS_1"] [:AMS_ASSET :AMS_ASSET_STATUS_VALUE "STATUS_2"] [:AMS_WF_ACTIVITY_PERM :AMS_USER_PERMISSION "USER_PERMISSION_REFID"] [:AMS_USER_ROLE_PERMISSION :AMS_USER_PERMISSION "USER_PERMISSION_ID"] [:AMS_WF_STATE :AMS_WF_STATUS "STATUS_CODE"] [:AMS_WF_ACTIVITY_STATUS :AMS_WF_STATUS "STATUS_CODE"] [:AMS_ORDER_CONTRACT :AMS_ORDER_WF_STATE "ORDER_WF_STATE_REF_ID"] [:AMS_TEST_FORM :AMS_TEST "TEST_REFERENCE_ID"] [:AMS_HOTSPOT_AREA :AMS_HOTSPOT_CHOICE "HS_CHOICE_REF_ID"] [:AMS_OTHER_ASSET_FV :AMS_OTHER_ASSET "OTHER_ASSET_REFID"] [:AMS_CONTENT_PART :AMS_OTHER_ASSET "OTHER_ASSET_REF_ID"] [:AMS_WF_TRANSITION_RULE :AMS_WF_ACTIVITY "DEST_ACTIVITY_REFID"] [:AMS_WF_TRANSITION_RULE :AMS_WF_ACTIVITY "SRC_ACTIVITY_REFID"] [:AMS_WF_STATE_SMY :AMS_WF_ACTIVITY "ACTIVITY_REF_ID"] [:AMS_WF_STATE :AMS_WF_ACTIVITY "ACTIVITY_REFID"] [:AMS_WF_ACTIVITY_STATUS :AMS_WF_ACTIVITY "ACTIVITY_REFID"] [:AMS_WF_ACTIVITY_PERM :AMS_WF_ACTIVITY "WF_ACTIVITY_REFID"] [:AMS_ORDER_WF_STATE :AMS_WF_ACTIVITY "ACTIVITY_REF_ID"] [:AMS_SEQ_REPORT :AMS_REPORTS "REPORT_ID"] [:AMS_ORDER_METADATA_FV :AMS_ASSET_ORDER "ORDER_REFID"] [:AMS_ORDER_DETAIL :AMS_ASSET_ORDER "ORDER_REFID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_REPORTING_CATEGORY "RPT_CATEGORY_REF_ID"] [:AMS_WF_STATE :AMS_USER "USER_REFID"] [:AMS_WF_STATE :AMS_USER "ASSIGNED_TO_USER_REFID"] [:AMS_USER_ACCOUNT_ROLE :AMS_USER "USER_REFERENCE_ID"] [:AMS_AUTH_GRANT :AMS_USER "USER_ID"] [:AMS_PUBCONFIG_ASSET :AMS_ASSET_FILE "ASSET_FILE_REF_ID"] [:AMS_ART_INFO :AMS_ASSET_FILE "ART_FILE_REF_ID"] [:AMS_ART_ASSET_FILE :AMS_ASSET_FILE "ASSET_FILE_REF_ID"] [:AMS_ITEM_STANDARD_ALIGNMENT :AMS_PGM_STANDARD_ALIGNMENT "PGM_STANDARDSET_REF_ID"] [:AMS_ITEM_ALIGN_SCHEME :AMS_PGM_STANDARD_ALIGNMENT "PGM_STANDARDSET_REF_ID"] [:AMS_WF_STATE :AMS_METADATA_FIELD "STATUS_2_OLD"] [:AMS_PGM_METADATA_FIELD :AMS_METADATA_FIELD "METADATA_FIELD_ID"] [:AMS_METADATA_VALUE :AMS_METADATA_FIELD "METADATA_FIELD_ID"] [:AMS_METADATA_FIELD :AMS_METADATA_FIELD "PARENT_METADATA_FIELD_ID"] [:AMS_ADP_METADATA_FV :AMS_METADATA_FIELD "METADATA_FIELD_REF_ID"] [:AMS_HOTSPOT_EXTENSION :AMS_ART_INFO "BACKGRND_ART_REF_ID"] [:AMS_HOTSPOT_EXTENSION :AMS_ART_INFO "HS_ICON_ART_REF_ID"] [:AMS_HOTSPOT_CHOICE :AMS_ART_INFO "ART_INFO_REF_ID"] [:AMS_HOTSPOT_CHOICE :AMS_ART_INFO "ALT_ART_INFO_REF_ID"] [:AMS_RATIONALE_SET :AMS_RATIONALE_SET "PARENT"] [:AMS_PGM_RATIONALE_SET :AMS_RATIONALE_SET "RATIONALE_SET_REF_ID"] [:AMS_CONTENT_PART :AMS_RATIONALE_SET "RATIONALE_SET_REF_ID"]))

(defn
  convert-form-string-to-map
  "converting request string '1=1&2=2&3=3' into map {:1 1, :2 2, :3 3}"
  [form-str]
  (reduce 
    #(assoc % (keyword (read-string (nth %2 1))) (nth %2 2)) {} 
      #_> (re-seq #"([^=&]+)=([^=&]+)" form-str)))


(defn map-tag [tag style-map xs]
  (map (fn [x] [tag style-map x]) xs))

(defn
  if-nil-or-empty
  [any]
  (or (nil? any) (empty? any)))


(defn
  val-up
  [vl]
  (st/upper-case (st/trim vl)))

(defn
  set-prf
  [pprf]
  (def prf pprf))